openapi: 3.0.3
info:
  title: CoffPOS API
  description: |
    Comprehensive REST API for CoffPOS - Modern Point of Sale System
    
    ## Features
    - Role-based authentication (Admin, Manager, Cashier)
    - Real-time POS operations
    - Inventory management
    - Customer & loyalty management
    - Transaction processing
    - Midtrans payment integration
    - Comprehensive reporting
    
  version: 1.0.0
  contact:
    name: CoffPOS Development Team
    email: support@coffpos.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8000
    description: Development server
  - url: https://your-domain.com
    description: Production server

security:
  - sessionAuth: []
  - sanctumAuth: []

tags:
  - name: Authentication
    description: User authentication and authorization
  - name: Dashboard
    description: Dashboard statistics and analytics
  - name: Products
    description: Product management operations
  - name: Categories
    description: Category management operations
  - name: Customers
    description: Customer management operations
  - name: Transactions
    description: Transaction management operations
  - name: POS
    description: Point of Sale operations
  - name: Cart
    description: Shopping cart management
  - name: Expenses
    description: Expense tracking operations
  - name: Users
    description: User management operations (Admin only)
  - name: Reports
    description: Reporting and analytics
  - name: Midtrans
    description: Midtrans payment integration

paths:
  # Authentication
  /login:
    post:
      tags: [Authentication]
      summary: User login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                  example: admin@coffpos.com
                password:
                  type: string
                  example: password
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'

  # Dashboard
  /admin/dashboard/stats:
    get:
      tags: [Dashboard]
      summary: Get dashboard statistics
      security:
        - sessionAuth: []
      responses:
        '200':
          description: Dashboard statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardStats'

  # Products
  /admin/products:
    get:
      tags: [Products]
      summary: List products with pagination and filters
      security:
        - sessionAuth: []
      parameters:
        - name: search
          in: query
          schema:
            type: string
          description: Search by name or description
        - name: category_id
          in: query
          schema:
            type: integer
          description: Filter by category ID
        - name: is_available
          in: query
          schema:
            type: boolean
          description: Filter by availability
        - name: stock_filter
          in: query
          schema:
            type: string
            enum: [low, out, available]
          description: Filter by stock level
        - name: sort_by
          in: query
          schema:
            type: string
            enum: [name, price, stock, created_at]
          description: Sort field
        - name: sort_order
          in: query
          schema:
            type: string
            enum: [asc, desc]
          description: Sort order
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
          description: Page number
        - name: per_page
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
          description: Items per page
      responses:
        '200':
          description: List of products
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductListResponse'

    post:
      tags: [Products]
      summary: Create a new product
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/ProductCreateRequest'
      responses:
        '201':
          description: Product created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /admin/products/{id}:
    get:
      tags: [Products]
      summary: Get product details
      security:
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Product details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'

    put:
      tags: [Products]
      summary: Update product
      security:
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/ProductUpdateRequest'
      responses:
        '200':
          description: Product updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

    delete:
      tags: [Products]
      summary: Delete product
      security:
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Product deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  # POS Operations
  /cashier/pos/cart/add:
    post:
      tags: [Cart]
      summary: Add item to cart
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [product_id, quantity]
              properties:
                product_id:
                  type: integer
                  example: 1
                quantity:
                  type: integer
                  minimum: 1
                  example: 2
      responses:
        '200':
          description: Item added to cart
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CartResponse'

  /cashier/pos/process-transaction:
    post:
      tags: [POS]
      summary: Process POS transaction
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransactionRequest'
      responses:
        '200':
          description: Transaction processed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransactionResponse'

  # Midtrans Integration
  /cashier/pos/midtrans/create-token:
    post:
      tags: [Midtrans]
      summary: Create Midtrans Snap token
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                customer_id:
                  type: integer
                  nullable: true
                  example: 1
      responses:
        '200':
          description: Snap token created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MidtransTokenResponse'

components:
  securitySchemes:
    sessionAuth:
      type: apiKey
      in: cookie
      name: laravel_session
    sanctumAuth:
      type: http
      scheme: bearer
      bearerFormat: token

  schemas:
    # Response Schemas
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Operation completed successfully"

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          example: "Error message"
        errors:
          type: object
          additionalProperties:
            type: array
            items:
              type: string

    PaginationMeta:
      type: object
      properties:
        current_page:
          type: integer
          example: 1
        last_page:
          type: integer
          example: 5
        per_page:
          type: integer
          example: 15
        total:
          type: integer
          example: 75
        from:
          type: integer
          example: 1
        to:
          type: integer
          example: 15

    # Authentication
    LoginResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        user:
          $ref: '#/components/schemas/User'
        redirect:
          type: string
          example: "/admin/dashboard"

    # User
    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Admin User"
        email:
          type: string
          format: email
          example: "admin@coffpos.com"
        role:
          type: string
          enum: [admin, manager, cashier]
          example: "admin"
        phone:
          type: string
          nullable: true
          example: "081234567890"
        avatar:
          type: string
          nullable: true
          example: "users/avatar.jpg"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    # Dashboard
    DashboardStats:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            today_revenue:
              type: number
              example: 1250000
            today_transactions:
              type: integer
              example: 45
            today_items_sold:
              type: integer
              example: 120
            low_stock_count:
              type: integer
              example: 8
            new_customers:
              type: integer
              example: 12
            top_products:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: integer
                  name:
                    type: string
                  sales_count:
                    type: integer
                  revenue:
                    type: number

    # Product
    Product:
      type: object
      properties:
        id:
          type: integer
          example: 1
        code:
          type: string
          example: "PROD1"
        name:
          type: string
          example: "Espresso"
        description:
          type: string
          nullable: true
          example: "Strong coffee shot"
        price:
          type: number
          format: decimal
          example: 15000
        cost:
          type: number
          format: decimal
          example: 10500
        stock:
          type: integer
          example: 50
        min_stock:
          type: integer
          example: 10
        image:
          type: string
          nullable: true
          example: "products/espresso.jpg"
        is_available:
          type: boolean
          example: true
        category_id:
          type: integer
          example: 1
        category:
          $ref: '#/components/schemas/Category'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ProductListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: array
          items:
            $ref: '#/components/schemas/Product'
        pagination:
          $ref: '#/components/schemas/PaginationMeta'

    ProductCreateRequest:
      type: object
      required: [category_id, name, price, cost, stock]
      properties:
        category_id:
          type: integer
          example: 1
        name:
          type: string
          example: "Cappuccino"
        description:
          type: string
          nullable: true
          example: "Coffee with steamed milk"
        price:
          type: number
          format: decimal
          example: 18000
        cost:
          type: number
          format: decimal
          example: 12600
        stock:
          type: integer
          example: 30
        min_stock:
          type: integer
          example: 5
        image:
          type: string
          format: binary
        is_available:
          type: boolean
          example: true

    ProductUpdateRequest:
      type: object
      properties:
        category_id:
          type: integer
          example: 1
        name:
          type: string
          example: "Cappuccino"
        description:
          type: string
          nullable: true
          example: "Coffee with steamed milk"
        price:
          type: number
          format: decimal
          example: 18000
        cost:
          type: number
          format: decimal
          example: 12600
        stock:
          type: integer
          example: 30
        min_stock:
          type: integer
          example: 5
        image:
          type: string
          format: binary
        is_available:
          type: boolean
          example: true

    # Category
    Category:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Coffee"
        description:
          type: string
          nullable: true
          example: "Hot and cold coffee beverages"
        image:
          type: string
          nullable: true
          example: "categories/coffee.jpg"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    # Customer
    Customer:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "John Doe"
        phone:
          type: string
          example: "081234567890"
        email:
          type: string
          format: email
          nullable: true
          example: "john@example.com"
        address:
          type: string
          nullable: true
          example: "Jakarta, Indonesia"
        points:
          type: integer
          example: 150
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    # Transaction
    Transaction:
      type: object
      properties:
        id:
          type: integer
          example: 123
        transaction_code:
          type: string
          example: "TRX-20251226-0001"
        user_id:
          type: integer
          example: 1
        customer_id:
          type: integer
          nullable: true
          example: 1
        subtotal:
          type: number
          format: decimal
          example: 30000
        discount:
          type: number
          format: decimal
          example: 0
        tax:
          type: number
          format: decimal
          example: 3000
        total:
          type: number
          format: decimal
          example: 33000
        payment_method:
          type: string
          enum: [cash, debit, credit, ewallet, qris, digital]
          example: "cash"
        payment_amount:
          type: number
          format: decimal
          example: 50000
        change_amount:
          type: number
          format: decimal
          example: 17000
        status:
          type: string
          enum: [completed, cancelled]
          example: "completed"
        payment_status:
          type: string
          enum: [pending, paid, failed, cancelled]
          example: "paid"
        notes:
          type: string
          nullable: true
          example: "Regular order"
        transaction_date:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    TransactionRequest:
      type: object
      required: [payment]
      properties:
        customer_id:
          type: integer
          nullable: true
          example: 1
        payment:
          type: object
          required: [method, amount]
          properties:
            method:
              type: string
              enum: [cash, debit, credit, e-wallet, qris]
              example: "cash"
            amount:
              type: number
              format: decimal
              example: 50000
            reference:
              type: string
              nullable: true
              example: null
        discount_amount:
          type: number
          format: decimal
          nullable: true
          example: 0
        discount_percent:
          type: number
          format: decimal
          nullable: true
          example: 0
        tax_percent:
          type: number
          format: decimal
          nullable: true
          example: 10
        use_loyalty_points:
          type: boolean
          nullable: true
          example: false
        loyalty_points_used:
          type: integer
          nullable: true
          example: 0
        notes:
          type: string
          nullable: true
          example: "Regular order"

    TransactionResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        transaction:
          $ref: '#/components/schemas/Transaction'
        receipt_data:
          type: object
          properties:
            store_info:
              type: object
            transaction:
              $ref: '#/components/schemas/Transaction'
            items:
              type: array
              items:
                type: object
        message:
          type: string
          example: "Transaction processed successfully"

    # Cart
    CartItem:
      type: object
      properties:
        product_id:
          type: integer
          example: 1
        name:
          type: string
          example: "Espresso"
        price:
          type: number
          format: decimal
          example: 15000
        quantity:
          type: integer
          example: 2
        image:
          type: string
          nullable: true
          example: "products/espresso.jpg"

    CartResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        cart:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/CartItem'
        total_items:
          type: integer
          example: 2

    # Midtrans
    MidtransTokenResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        snap_token:
          type: string
          example: "66e4fa55-fdac-4ef9-91b5-733b97d1b862"
        order_id:
          type: string
          example: "ORDER-20251226-001"
        total_amount:
          type: number
          format: decimal
          example: 33000
        client_key:
          type: string
          example: "SB-Mid-client-xxx"

    # Expense
    Expense:
      type: object
      properties:
        id:
          type: integer
          example: 1
        user_id:
          type: integer
          example: 1
        category:
          type: string
          enum: [inventory, operational, salary, utilities, other]
          example: "operational"
        description:
          type: string
          example: "Office supplies"
        amount:
          type: number
          format: decimal
          example: 150000
        receipt_image:
          type: string
          nullable: true
          example: "receipts/receipt.jpg"
        expense_date:
          type: string
          format: date
          example: "2025-12-26"
        notes:
          type: string
          nullable: true
          example: "Monthly office supplies purchase"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time